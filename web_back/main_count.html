<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>图表统计</title>
  <link rel="stylesheet" href="js/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/iconfont.css">
  <link rel="stylesheet" href="css/main.css">
  <script src="js/jquery-1.12.4.min.js"></script>
  <script type="text/javascript" src="js/echarts.min.js"></script>
</head>

<body>
  <div class="container-fluid">
    <div class="row spannel_list">
      <div class="col-sm-3 col-xs-6">
        <div class="spannel scolor00">
          <em>10015</em><span>篇</span>
          <b>总文章数</b>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6">
        <div class="spannel scolor01">
          <em>123</em><span>篇</span>
          <b>日新增文章数</b>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6">
        <div class="spannel scolor02">
          <em>35</em><span>条</span>
          <b>评论总数</b>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6">
        <div class="spannel scolor03">
          <em>123</em><span>条</span>
          <b>日新增评论数</b>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row curve-pie">
      <div class="col-lg-8 col-md-8">
        <div class="gragh_pannel" id="curve_show"></div>
      </div>
      <div class="col-lg-4 col-md-4">
        <div class="gragh_pannel" id="pie_show"></div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="column_pannel" id="column_show"></div>
  </div>

  <script>
    // 日新增文章图
    var oChart = echarts.init(document.getElementById('curve_show'));
    var aList_all = [
      { 'count': 36, 'date': '2019-04-13' },
      { 'count': 52, 'date': '2019-04-14' },
      { 'count': 78, 'date': '2019-04-15' },
      { 'count': 85, 'date': '2019-04-16' },
      { 'count': 65, 'date': '2019-04-17' },
      { 'count': 72, 'date': '2019-04-18' },
      { 'count': 88, 'date': '2019-04-19' },
      { 'count': 64, 'date': '2019-04-20' },
      { 'count': 72, 'date': '2019-04-21' },
      { 'count': 90, 'date': '2019-04-22' },
      { 'count': 96, 'date': '2019-04-23' },
      { 'count': 100, 'date': '2019-04-24' },
      { 'count': 102, 'date': '2019-04-25' },
      { 'count': 110, 'date': '2019-04-26' },
      { 'count': 123, 'date': '2019-04-27' },
      { 'count': 100, 'date': '2019-04-28' },
      { 'count': 132, 'date': '2019-04-29' },
      { 'count': 146, 'date': '2019-04-30' },
      { 'count': 200, 'date': '2019-05-01' },
      { 'count': 180, 'date': '2019-05-02' },
      { 'count': 163, 'date': '2019-05-03' },
      { 'count': 110, 'date': '2019-05-04' },
      { 'count': 80, 'date': '2019-05-05' },
      { 'count': 82, 'date': '2019-05-06' },
      { 'count': 70, 'date': '2019-05-07' },
      { 'count': 65, 'date': '2019-05-08' },
      { 'count': 54, 'date': '2019-05-09' },
      { 'count': 40, 'date': '2019-05-10' },
      { 'count': 45, 'date': '2019-05-11' },
      { 'count': 38, 'date': '2019-05-12' },
    ];

    let aCount = [];
    let aDate = [];

    for (var i = 0; i < aList_all.length; i++) {
      aCount.push(aList_all[i].count);
      aDate.push(aList_all[i].date);
    }

    var chartopt = {
      title: {
        text: '日新增文章数',
        left: 'center',
        top: '10'
      },
      tooltip: {
        trigger: 'axis'
      },
      legend: {
        data: ['新增文章'],
        top: '40'
      },
      toolbox: {
        show: true,
        feature: {
          mark: { show: true },
          dataView: { show: true, readOnly: false },
          magicType: { show: true, type: ['line', 'bar'] },
          restore: { show: true },
          saveAsImage: { show: true }
        }
      },
      calculable: true,
      xAxis: [
        {
          name: '日',
          type: 'category',
          boundaryGap: false,
          data: aDate
        }
      ],
      yAxis: [
        {
          name: '日新增文章数',
          type: 'value'
        }
      ],
      series: [
        {
          name: '新增文章',
          type: 'line',
          smooth: true,
          itemStyle: { normal: { areaStyle: { type: 'default' }, color: '#f80' }, lineStyle: { color: '#f80' } },
          data: aCount
        }],
      areaStyle: {
        normal: {
          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
            offset: 0,
            color: 'rgba(255,136,0,0.39)'
          }, {
            offset: .34,
            color: 'rgba(255,180,0,0.25)'
          }, {
            offset: 1,
            color: 'rgba(255,222,0,0.00)'
          }])

        }
      },
      grid: {
        show: true,
        x: 50,
        x2: 50,
        y: 80,
        height: 220
      }
    };
    oChart.setOption(chartopt);

    //分类文章数量比饼图
    var oPie = echarts.init(document.getElementById('pie_show'));
    var oPieopt =
    {
      title: {
        top: 10,
        text: '分类文章数量比',
        x: 'center'
      },
      tooltip: {
        trigger: 'item',
        formatter: "{a} <br/>{b} : {c} ({d}%)"
      },
      color: ['#5885e8', '#13cfd5', '#00ce68', '#ff9565'],
      legend: {
        x: 'center',
        top: 65,
        data: ['奇趣事', '会生活', '爱旅行', '趣美味']
      },
      toolbox: {
        show: true,
        x: 'center',
        top: 35,
        feature: {
          mark: { show: true },
          dataView: { show: true, readOnly: false },
          magicType: {
            show: true,
            type: ['pie', 'funnel'],
            option: {
              funnel: {
                x: '25%',
                width: '50%',
                funnelAlign: 'left',
                max: 1548
              }
            }
          },
          restore: { show: true },
          saveAsImage: { show: true }
        }
      },
      calculable: true,
      series: [
        {
          name: '访问来源',
          type: 'pie',
          radius: ['45%', '60%'],
          center: ['50%', '65%'],
          data: [
            { value: 300, name: '奇趣事' },
            { value: 100, name: '会生活' },
            { value: 260, name: '爱旅行' },
            { value: 180, name: '趣美味' }
          ]
        }
      ]
    };
    oPie.setOption(oPieopt);

    //文章访问量柱状图
    var oColumn = this.echarts.init(document.getElementById('column_show'));
    var oColumnopt = {
      color: ['#14e3ea'],
      title: {
        text: '文章访问量',
        left: 'center',
        top: '10'
      },
      tooltip: {
        trigger: 'axis'
      },

      calculable: true,
      xAxis: {
        type: 'category',
        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
      },
      yAxis: {
        type: 'value'
      },
      series: [{
        data: [120, 200, 150, 80, 70, 110, 130],
        type: 'bar'
      }],
      toolbox: {
        show: true,
        x: 'center',
        top: 35,
        feature: {
          mark: { show: true },
          dataView: { show: true, readOnly: false },
          magicType: {
            show: true,
            type: ['pie', 'funnel'],
            option: {
              funnel: {
                x: '25%',
                width: '50%',
                funnelAlign: 'left',
                max: 1548
              }
            }
          },
          restore: { show: true },
          saveAsImage: { show: true }
        }
      },
      grid: {
        show: true,
        x: 80,
        x2: 80,
        y: 80,
        height: 260
      },

    };

    oColumn.setOption(oColumnopt);

  </script>
  <script>
    let pieLegendData = [];
    /**
     * @description: 获取所有的分类
     * @param {type} 
     * @return {type} 
     */
    function getCategory() {
      $.ajax({
        url: 'http://localhost:8080/admin/category/list',
        success: res => {

          if (res.code == 200) {
            for (let i = 0; i < res.data.length; i++) {
              pieCategoryData.push(res.data[i].name);
            }
            // console.log(pieCategoryData);
            oPie.setOption({
              // legend: {
              //   x: 'center',
              //   top: 65,
              //   data: pieCategoryData
              // },
            })
          }
        }
      })
    }
    /**
    * @description: 获取总统计数据
    * @param {type} 
    * @return {type} 
    */
    function getDataInfo() {
      $.ajax({
        url: 'http://localhost:8080/admin/data/info',
        success: res => {
          $('.scolor00>em').text(res.totalArticle);
          $('.scolor01>em').text(res.dayArticle);
          $('.scolor02>em').text(res.totalComment);
          $('.scolor03>em').text(res.dayComment);
        }
      })
    }
    /**
     * @description: 日新增文章数
     * @param {type} 
     * @return {type} 
     */
    function getDayArticle() {
      $.ajax({
        url: 'http://localhost:8080/admin/data/article',
        success: res => {
          if (res.code == 200) {
            aList_all = [...res.date];
            aCount = [];
            aDate = [];
            for (var i = 0; i < aList_all.length; i++) {
              aCount.push(aList_all[i].count);
              aDate.push(aList_all[i].date);
            }
            oChart.setOption({
              xAxis: {
                data: aDate
              },
              series: [{
                data: aCount
              }]
            })
          }
        }
      })
    }
    /**
     * @description: 各类型文章数量统计
     * @param {type} 
     * @return {type} 
     */
    function getCategoryData() {
      let pieCategoryData = [];

      $.ajax({
        url: 'http://localhost:8080/admin/data/category',
        success: res => {
          if (res.code == 200) {
            for (let i = 0; i < res.date.length; i++) {
              pieLegendData.push(res.date[i].name);
              let obj = {};
              obj.value = res.date[i].articles;
              obj.name = res.date[i].name;
              pieCategoryData.push(obj);
            }
            oPie.setOption({
              legend: {
                x: 'center',
                top: 65,
                data: pieLegendData
              },
              series: [
                {
                  data: pieCategoryData
                }
              ]
            })
            // console.log(pieLegendData);
          }
        }
      })
    }
    /**
     * @description: 日文章访问量
     * @param {type} 
     * @return {type} 
     */
    function getDateVisit() {
      let dayVisitXData = [];
      let dayVisitYData = [];
      $.ajax({
        url: 'http://localhost:8080/admin/data/visit',
        success: res => {
          if (res.code == 200) {
            for (let key in res.data) {
              dayVisitXData.push(key);
              dayVisitYData.push(res.data[key]);
            }
            dayVisitXData = dayVisitXData.reverse();
            dayVisitYData = dayVisitYData.reverse();
            oColumn.setOption({
              xAxis: [
                {
                  data: dayVisitXData
                }
              ],
              series: [
                {
                  data: dayVisitYData
                }
              ]
            })
          }
        }
      })
    }
    $(function () {
      getDataInfo();
      getDayArticle();
      getCategoryData();
      getDateVisit();
    })
  </script>



</body>

</html>